$(document).ready(function(){getAccessToken().then(function(n){const t=(new signalR.HubConnectionBuilder).withUrl("/chat?token="+n).configureLogging(signalR.LogLevel.Trace).build();t.start().catch(n=>console.error(n));t.on("Receive",(n,t)=>{const i=receiveMessage(n,t==="expert");$("#messagesList").append(i).scrollTo(i)});t.on("Join",(n,t,i,r)=>{const f=joinUser(n,t==="expert",i,r);$("#messagesList").append(f).scrollTo(f);u(i)});t.on("Leave",(n,t)=>{const i=leaveUser(n,t==="expert");$("#messagesList").append(i).scrollTo(i);u(!1)});$("#sendButton").on("click",()=>{t.invoke("SendMessage",$("#messageText").val()).catch(n=>console.error(n)),$("#messageText").val("")});$("#quickReplyButton").on("click",()=>r());$(".list-item").on("click",function(){insertAtCursor($("#messageText"),$(this).text());r()});const r=()=>{$("#quickReplyBlock").toggle(),$("#quickReplyButton").toggleClass("send-button")},u=function(n){const t=n?"Подключен к чату":"Отключен от чата";$("#onlineStatus").text(t)},f=function(t){var r=luxon.Duration.fromMillis(t.remainingTime);$("#remainingTime").text(r.toFormat("mm 'минут'"));setTimeout(updateInfo,i,i,n,f)},i=1e4;updateInfo(i,n,f)}).catch(n=>alert(n))});