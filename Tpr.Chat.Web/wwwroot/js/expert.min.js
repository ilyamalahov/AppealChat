$(document).ready(function(){getAccessToken().then(function(n){const t=(new signalR.HubConnectionBuilder).withUrl("/chat",{accessTokenFactory:()=>n}).build();t.start().catch(n=>console.error(n));t.on("Receive",(n,t)=>{const i=receiveMessage(n,t==="expert");$("#messagesList").append(i).scrollTo(i)});t.on("Join",(n,t,i,r)=>{const u=joinUser(n,t==="expert",i,r);$("#messagesList").append(u).scrollTo(u);f(i)});t.on("Leave",(n,t)=>{const i=leaveUser(n,t==="expert");$("#messagesList").append(i).scrollTo(i);f(!1)});$("#sendButton").on("click",()=>{t.invoke("SendMessage",$("#messageText").val()).catch(n=>console.error(n)),$("#messageText").val("")});var i=!1;$("#quickReplyButton").on("click",()=>{i=!i,u(i)});$(".list-item").on("click",function(){u(!1);insertAtCursor($("#messageText"),$(this).text())});$("#filterText").on("input",function(){var n=$(this).val();$(".list-item").each(function(){const t=$(this).is(":icontains('"+n+"')");$(this).toggle(t)})});const u=n=>{$("#quickReplyBlock").slideToggle(n);$("#quickReplyButton").toggleClass("send-button",n);const t=n?"Убрать":"Быстрый ответ";$("#quickReplyButton").text(t);n&&$("#filterText").focus()},f=function(n){const t=n?"Подключен к чату":"Отключен от чата";$("#onlineStatus").text(t)},e=function(n){var u=luxon.Duration.fromMillis(n.remainingTime),t=u.toFormat("m"),i;t<=0&&$("#remainingTime").text(t);n.isAlarm&&(i="До окончания консультации осталось "+t+" минут(-ы)",$("#alarm").text(i).show());setTimeout(updateInfo,r,r,appealId,e)},r=1e4;updateInfo(r,appealId,e)}).catch(n=>alert(n))});