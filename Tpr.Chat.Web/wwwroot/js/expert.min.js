$(document).ready(function(){getAccessToken().then(function(n){var u,t;const r=(new signalR.HubConnectionBuilder).withUrl("/info").build();r.on("ReceiveInfo",(n,t,i,r)=>{var f,o,e,l;r&&h();f=luxon.Duration.fromMillis(t);o=f.as("minutes");e=o<1?"меньше минуты":f.toFormat("m минут(-ы)");$("#remainingTime").text(e);i&&(l="До окончания консультации осталось "+e,$("#alarm").text(l).show());u=setTimeout(s,c)});const i=(new signalR.HubConnectionBuilder).withUrl("/chat",{accessTokenFactory:()=>n}).build();i.on("Receive",(n,t)=>{const i=receiveMessage(n,t==="expert");$("#messagesList").append(i).scrollTo(i)});i.on("Join",(n,t,i)=>{const r=joinMessage(n,t==="expert");$("#messagesList").append(r).scrollTo(r);o(i)});i.on("Leave",(n,t)=>{const i=leaveMessage(n,t==="expert");$("#messagesList").append(i).scrollTo(i);o(!1)});$("#sendButton").on("click",()=>e($("#messageText").val()));t=!1;$("#quickReplyButton").on("click",()=>{t=!t,f(t)});$(".list-item").on("click",function(){t=!1;f(t);$("#messageText").insertAtCursor($(this).text()).focus().trigger("input")});$("#filterText").on("input",function(){var n=$(this).val();$(".list-item").each(function(){const t=$(this).is(":icontains('"+n+"')");$(this).toggle(t)})});$("#messageText").on("keyup",function(n){n.keyCode!==13||n.shiftKey||(n.preventDefault(),$(this).val().length>0&&e($(this).val()))});$("#messageText").on("input",function(){const n=$(this).val().length>0;$("#sendButton").prop("disabled",!n)});$("#messageText").trigger("input");const f=n=>{$("#quickReplyBlock").slideToggle(n);$("#quickReplyButton").toggleClass("send-button",n);const t=n?"Убрать":"Быстрый ответ";$("#quickReplyButton").text(t);$("#filterText").val("").trigger("input");n&&$("#filterText").focus()},e=n=>{i.invoke("SendMessage",n).catch(n=>console.error(n.error)),$("#messageText").val("").trigger("input")},o=n=>{const t=n?"Подключен к чату":"Отключен от чата";$("#onlineStatus").text(t)},h=()=>{clearTimeout(u),$("#interactiveBlock").hide()},c=1e4,s=()=>r.invoke("MainUpdate",appealId);i.start().catch(n=>console.error(n.toString()));r.start().then(s).catch(n=>console.error(n.toString()))}).catch(n=>alert(n.error))});