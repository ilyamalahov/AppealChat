$(document).ready(function(){getAccessToken().then(function(n){const t=(new signalR.HubConnectionBuilder).withUrl("/chat",{accessTokenFactory:()=>n}).build();t.start().catch(n=>console.error(n));t.on("Receive",(n,t)=>{const i=receiveMessage(n,t==="expert");$("#messagesList").append(i).scrollTo(i)});t.on("Join",(n,t,i,r)=>{const u=joinUser(n,t==="expert",i,r);$("#messagesList").append(u).scrollTo(u);f(i)});t.on("Leave",(n,t)=>{const i=leaveUser(n,t==="expert");$("#messagesList").append(i).scrollTo(i);f(!1)});$("#sendButton").on("click",()=>o($("#messageText").val()));var i=!1;$("#quickReplyButton").on("click",()=>{i=!i,u(i)});$(".list-item").on("click",function(){u(!1);insertAtCursor($("#messageText"),$(this).text())});$("#filterText").on("input",function(){var n=$(this).val();$(".list-item").each(function(){const t=$(this).is(":icontains('"+n+"')");$(this).toggle(t)})});$("#messageText").on("keyup",messageTextKeyup);$("#messageText").on("input",function(){const n=$(this).val()==="";$("#sendButton").prop("disabled",n)});const u=n=>{$("#quickReplyBlock").slideToggle(n);$("#quickReplyButton").toggleClass("send-button",n);const t=n?"Убрать":"Быстрый ответ";$("#quickReplyButton").text(t);n&&$("#filterText").focus()},o=n=>{t.invoke("SendMessage",n).catch(n=>console.error(n)),$("#messageText").val("").trigger("input")},f=function(n){const t=n?"Подключен к чату":"Отключен от чата";$("#onlineStatus").text(t)},e=function(n){var i=luxon.Duration.fromMillis(n.remainingTime),f=i.as("minutes"),t,u;t=f<=0?"меньше минуты":i.toFormat("m минут(-ы)");$("#remainingTime").text(t);n.isAlarm&&(u="До окончания консультации осталось "+t,$("#alarm").text(u).show());setTimeout(updateInfo,r,r,appealId,e)},r=1e4;updateInfo(r,appealId,e)}).catch(n=>alert(n))});