$(document).ready(function(){getAccessToken().then(function(n){const t=(new signalR.HubConnectionBuilder).withUrl("/chat?token="+n).configureLogging(signalR.LogLevel.Trace).build();t.start().catch(n=>console.error(n));t.on("Receive",(n,t)=>{const i=receiveMessage(n,t==="expert");$("#messagesList").append(i).scrollTo(i)});t.on("Join",(n,t,i,r)=>{const u=joinUser(n,t==="expert",i,r);$("#messagesList").append(u).scrollTo(u);f(i)});t.on("Leave",(n,t)=>{const i=leaveUser(n,t==="expert");$("#messagesList").append(i).scrollTo(i);f(!1)});$("#sendButton").on("click",()=>{t.invoke("SendMessage",$("#messageText").val()).catch(n=>console.error(n)),$("#messageText").val("")});var i=!1;$("#quickReplyButton").on("click",()=>{i=!i,u(i)});$(".list-item").on("click",function(){u(!1);insertAtCursor($("#messageText"),$(this).text())});$("#filterText").on("input",function(){var n=$(this).val();$(".list-item").each(function(){const t=$(this).is(":icontains('"+n+"')");$(this).toggle(t)})});const u=n=>{$("#quickReplyBlock").slideToggle(n),$("#quickReplyButton").toggleClass("send-button",n),n&&$("#filterText").focus()},f=function(n){const t=n?"Подключен к чату":"Отключен от чата";$("#onlineStatus").text(t)},e=function(t){var f=luxon.Duration.fromMillis(t.remainingTime),i=f.toFormat("m"),u;$("#remainingTime").text(i);t.isAlarm&&(u="До окончания консультации осталось "+i+" минут(-ы)",$("#alarm").text(u).show());setTimeout(updateInfo,r,r,n,e)},r=1e4;updateInfo(r,n,e)}).catch(n=>alert(n))});