$(document).ready(function(){getAccessToken().then(function(n){var u,r;const i=(new signalR.HubConnectionBuilder).withUrl("/info").build();i.on("ReceiveInfo",(n,t,i,r)=>{var f,o,e,l;r&&h();f=luxon.Duration.fromMillis(t);o=f.as("minutes");e=o<1?"меньше минуты":f.toFormat("m минут(-ы)");$("#remainingTime").text(e);i&&(l="До окончания консультации осталось "+e,$("#alarm").text(l).show());u=setTimeout(s,c)});const t=(new signalR.HubConnectionBuilder).withUrl("/chat",{accessTokenFactory:()=>n}).build();t.on("Receive",(n,t)=>{const i=receiveMessage(n,t==="expert");$("#messagesList").append(i).scrollTo(i)});t.on("Join",(n,t,i)=>{const r=joinMessage(n,t==="expert");$("#messagesList").append(r).scrollTo(r);o(i)});t.on("Leave",(n,t)=>{const i=leaveMessage(n,t==="expert");$("#messagesList").append(i).scrollTo(i);o(!1)});$("#sendButton").on("click",()=>e($("#messageText").val()));r=!1;$("#quickReplyButton").on("click",()=>f(!r));$("#replyList").on("click","li",function(){f(!1);$("#messageText").insertAtCursor($(this).text()).focus().trigger("input")});$("#filterText").on("input",function(){var n=$(this).val();$(".list-item").each(function(){const t=$(this).is(":icontains('"+n+"')");$(this).toggle(t)})});$("#messageText").on("keyup",function(n){n.keyCode!==13||n.shiftKey||(n.preventDefault(),$(this).val().length>0&&e($(this).val()))});$("#messageText").on("input",function(){const n=$(this).val().length>0;$("#sendButton").prop("disabled",!n)});$("#messageText").trigger("input");const f=n=>{r=n;$("#quickReplyBlock").slideToggle(n);const t=n?"images/png/back.png":"images/png/chat.png";$("#quickReplyButton>img").attr("src",t);$("#filterText").val("").trigger("input");n&&$("#filterText").focus()},e=n=>{t.invoke("SendMessage",n).catch(n=>console.error(n.error)),$("#messageText").val("").trigger("input")},o=n=>{$("#onlineStatus").toggleClass("online",n)},h=()=>{t.stop(),i.stop(),clearTimeout(u),$("#interactiveBlock").hide()},c=1e4,s=()=>i.invoke("MainUpdate",appealId);t.start().catch(n=>console.error(n.toString()));i.start().then(s).catch(n=>console.error(n.toString()))}).catch(n=>alert(n.error))});