$(document).ready(function(){getAccessToken().then(function(n){var u,r;const i=(new signalR.HubConnectionBuilder).withUrl("/info").build();i.on("ReceiveInfo",(n,t,i,r)=>{var f,o,e,l;r&&h();f=luxon.Duration.fromMillis(t);o=f.as("minutes");e=o<1?"меньше минуты":f.toFormat("m минут(-ы)");$("#remainingTime").text(e);i&&(l="До окончания консультации осталось "+e,$("#alarm").text(l).show());u=setTimeout(s,c)});const t=(new signalR.HubConnectionBuilder).withUrl("/chat",{accessTokenFactory:()=>n}).build();t.on("Receive",n=>{const i=n.nickName==="Член КК № "+expertKey,t=receiveMessage(n,i);$("#messagesList").append(t).scrollTo(t)});t.on("Join",(n,t)=>{o(t);const r=n.nickName==="Член КК № "+expertKey,i=joinMessage(n,r);$("#messagesList").append(i).scrollTo(i)});t.on("Leave",n=>{o(!1);const i=n.nickName==="Член КК № "+expertKey,t=leaveMessage(n,i);$("#messagesList").append(t).scrollTo(t)});t.on("FirstJoinExpert",n=>{const i=n!=="Аппелянт",t=firstJoinExpertMessage(n,i);$("#messagesList").append(t).scrollTo(t)});$("#sendButton").on("click",()=>e($("#messageText").val()));r=!1;$("#quickReplyButton").on("click",()=>f(!r));$("#replyList").on("click","li",function(){f(!1);$("#messageText").insertAtCursor($(this).text()).focus().trigger("input")});$("#filterText").on("input",function(){var n=$(this).val();$("#replyList li").hide().filter(":icontains('"+n+"')").show().each((t,i)=>$(i).highlightText(n))});$("#messageText").on("keyup",function(n){n.keyCode!==13||n.shiftKey||(n.preventDefault(),$(this).val().length>0&&e($(this).val()))});$("#messageText").on("input",function(){const n=$(this).val().length===0;$("#sendButton").prop("disabled",n)});$("#messageText").trigger("input");const f=n=>{r=n,n?($("#quickReplyButton>img").attr("src","images/down-chevron.svg"),$("#quickReplyBlock").slideDown("fast",()=>$("#filterText").focus()),$("#quickReplyOverlay").fadeIn("fast")):($("#quickReplyButton>img").attr("src","images/question.svg"),$("#quickReplyBlock").slideUp("fast",()=>$("#filterText").val("").trigger("input")),$("#quickReplyOverlay").fadeOut("fast"))},e=n=>{t.invoke("SendMessage",n).catch(n=>console.error(n.error)),$("#messageText").val("").trigger("input")},o=n=>$("#onlineStatus").toggleClass("online",n),h=()=>{t.stop(),i.stop(),clearTimeout(u),$("#interactiveBlock").hide()},c=1e4,s=()=>i.invoke("MainUpdate",appealId);t.start().catch(n=>console.error(n.toString()));i.start().then(s).catch(n=>console.error(n.toString()))}).catch(n=>alert(n.error))});