$(document).ready(function(){getAccessToken().then(n=>{const t=(new signalR.HubConnectionBuilder).withUrl("/chat?token="+n).configureLogging(signalR.LogLevel.Trace).build();t.start().catch(n=>console.error(n));t.on("Receive",(n,t)=>{const i=receiveMessage(n,t==="appeal");$("#messagesList").append(i).scrollTo(i)});t.on("Join",(n,t,i,r)=>{const u=joinUser(n,t==="appeal",i,r);$("#messagesList").append(u).scrollTo(u);e(r)});t.on("Leave",(n,t)=>{const i=leaveUser(n,t==="appeal");$("#messagesList").append(i).scrollTo(i);e(!1)});$("#sendButton").on("click",()=>{u($("#messageText").val())});$("#messageText").on("input",function(n){var t=n.target;t.rows=s(t);o($(this).val()==="")});$("#messageText").on("keyup",function(n){n.keyCode!==13||n.shiftKey||(n.preventDefault(),$(this).val()!==""&&u($(this).val()))});$("#emojiButton").on("click",()=>{$("#emojiGrid").toggle(),$(this).children("i").toggleClass("far fa-smile"),$(this).children("i").toggleClass("fas fa-chevron-circle-down")});$("#switchExpertButton").on("click",()=>showModal("ajax/changeexpert"));$("#completeButton").on("click",()=>showModal("ajax/complete"));$("#completeOkButton").on("click",()=>{alert(),closeModal()});const i=n=>{n?($("#changeOverlay").show(),$("#changeSpinner").show()):($("#changeOverlay").hide(),$("#changeSpinner").hide()),$("#switchExpertButton").prop("disabled",!n)},h=(n,t)=>{var r=$('<div class="message '+(t?"place-left":"place-right")+'"><\/div>').html(n),i=$("<li><\/li>").html(r);$("#messagesList").append(i).scrollTo(i)},u=n=>{t.invoke("SendMessage",n).catch(n=>console.error(n)),$("#messageText").val("").trigger("input")},o=n=>{$("#sendButton").prop("disabled",n)},s=n=>{var i=n.dataset.minRows|1,t=Math.ceil((n.scrollHeight-n.clientHeight)/16);return console.log(t),Math.max(i,Math.min(t,4))},f=t=>{var i=luxon.DateTime.fromMillis(t.moscowDate,{zone:"utc+3"}),u=luxon.Duration.fromMillis(t.remainingTime);$("#remainingTime").text(u.toFormat("mm 'минут'"));$("#moscowTime").text(i.toFormat("t"));setTimeout(updateInfo,r,r,n,f)},e=n=>{const t=n?"В сети":"Не в сети";$("#onlineStatus").text(t)},r=1e4;updateInfo(r,n,f);$(this).on("click","#changeOkButton",()=>{changeExpert(n,()=>{closeModal(),i(!0)}).then(n=>{$("#expertNumber").val(n.expertKey),i(!1)}).catch(n=>{alert(n.error),i(!1)})})})});