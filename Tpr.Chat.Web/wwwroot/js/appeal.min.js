$(document).ready(function(){getAccessToken().then(function(n){const t=(new signalR.HubConnectionBuilder).withUrl("/chat?token="+n).configureLogging(signalR.LogLevel.Trace).build();t.start().catch(n=>console.error(n));t.on("Receive",(n,t)=>{const i=receiveMessage(n,t==="appeal");$("#messagesList").append(i).scrollTo(i)});t.on("Join",(n,t,i,r)=>{const u=joinUser(n,t==="appeal",i,r);$("#messagesList").append(u).scrollTo(u);e(r)});t.on("Leave",(n,t)=>{const i=leaveUser(n,t==="appeal");$("#messagesList").append(i).scrollTo(i);e(!1)});$("#sendButton").on("click",()=>{r($("#messageText").val())});$("#messageText").on("input.autoExpand",()=>{this.rows=$(this).data("min-rows")|0;var n=Math.ceil((this.scrollHeight-this.clientHeight)/16),t=Math.max(0,Math.min(n,4));this.rows+=t});$("#messageText").on("change keyup",function(n){n.keyCode!==13||n.shiftKey||(n.preventDefault(),$(this).val()!==""&&r($(this).val()));u($(this).val()==="")});$("#emojiButton").on("click",()=>{$("#emojiGrid").toggle(),$(this).children("i").toggleClass("far fa-smile"),$(this).children("i").toggleClass("fas fa-chevron-circle-down")});$("#switchExpertButton").on("click",()=>showModal("ajax/changeexpert"));$("#completeButton").on("click",()=>showModal("ajax/complete"));const o=(n,t)=>{var r=$('<div class="message '+(t?"place-left":"place-right")+'"><\/div>').html(n),i=$("<li><\/li>").html(r);$("#messagesList").append(i).scrollTo(i)},r=n=>{t.invoke("SendMessage",n).catch(n=>console.error(n)),$("#messageText").val("")},u=function(n){$("#sendButton").prop("disabled",n)},f=t=>{var r=luxon.DateTime.fromMillis(t.moscowDate,{zone:"utc+3"}),u=luxon.Duration.fromMillis(t.remainingTime);$("#remainingTime").text(u.toFormat("mm 'минут'"));$("#moscowTime").text(r.toFormat("t"));setTimeout(updateInfo,i,i,n,f)};u(!0);const e=n=>{const t=n?"В сети":"Не в сети";$("#onlineStatus").text(t)},i=1e4;updateInfo(i,n,f)})});