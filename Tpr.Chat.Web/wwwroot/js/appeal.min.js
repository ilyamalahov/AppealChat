$(document).ready(function(){getAccessToken().then(function(n){const t=(new signalR.HubConnectionBuilder).withUrl("/chat?token="+n).configureLogging(signalR.LogLevel.Trace).build();t.start().catch(n=>console.error(n));t.on("Receive",(n,t)=>{const i=receiveMessage(n,t==="appeal");$("#messagesList").append(i).scrollTo(i)});t.on("Join",(n,t,i,r)=>{const u=joinUser(n,t==="appeal",i,r);$("#messagesList").append(u).scrollTo(u);f(r)});t.on("Leave",(n,t)=>{const i=leaveUser(n,t==="appeal");$("#messagesList").append(i).scrollTo(i);f(!1)});$("#sendButton").on("click",()=>{r($("#messageText").val())});$("#messageText").on("input",function(n){var t=o(n.target);$(this).attr("rows",t);e($(this).val()==="")});$("#messageText").on("keyup",function(n){n.keyCode!==13||n.shiftKey||(n.preventDefault(),$(this).val()!==""&&r($(this).val()))});$("#emojiButton").on("click",()=>{$("#emojiGrid").toggle(),$(this).children("i").toggleClass("far fa-smile"),$(this).children("i").toggleClass("fas fa-chevron-circle-down")});$("#switchExpertButton").on("click",()=>showModal("ajax/changeexpert"));$("#completeButton").on("click",()=>showModal("ajax/complete"));const s=(n,t)=>{var r=$('<div class="message '+(t?"place-left":"place-right")+'"><\/div>').html(n),i=$("<li><\/li>").html(r);$("#messagesList").append(i).scrollTo(i)},r=n=>{t.invoke("SendMessage",n).catch(n=>console.error(n)),$("#messageText").val("").trigger("input")},e=n=>{$("#sendButton").prop("disabled",n)},o=n=>{var t=n.dataset.minRows|1,i;return n.rows=t,i=Math.ceil((n.scrollHeight-n.clientHeight)/16),Math.max(t,Math.min(i,5))},u=t=>{var r=luxon.DateTime.fromMillis(t.moscowDate,{zone:"utc+3"}),f=luxon.Duration.fromMillis(t.remainingTime);$("#remainingTime").text(f.toFormat("mm 'минут'"));$("#moscowTime").text(r.toFormat("t"));setTimeout(updateInfo,i,i,n,u)},f=n=>{const t=n?"В сети":"Не в сети";$("#onlineStatus").text(t)},i=1e4;updateInfo(i,n,u)})});