@using Tpr.Chat.Core.Models
@model Tpr.Chat.Web.Models.IndexViewModel

@{
    ViewData["Title"] = "Home Page";
}

@section Styles {
    <link rel="stylesheet" type="text/css" href="~/css/appeal.css" />
}

@section Scripts {
    <script>
        var appealId = "@Model.ChatSession.AppealId";
        var expertKey = "@Model.ExpertKey";
    </script>
    <script type="text/javascript" src="~/js/luxon.min.js"></script>
    <script type="text/javascript" src="~/lib/signalr/signalr.js"></script>
    <script type="text/javascript" src="~/js/appeal.js"></script>
}

<div class="container">
    <div class="header">
        <div class="moscow-time">
            <div class="time-value" id="moscowTime">00:00</div>
            <div class="time-caption">Московское время</div>
        </div>
        <div class="header-title">Онлайн консультации по результатам рассмотрения апелляций о несогласии с выставленными баллами ГИА</div>
        <div class="buttons-block">
            <button class="custom-button header-button"><img src="images/png/round-help-button.png" alt="Help" /></button>
            <button class="custom-button header-button"><img src="images/png/login.png" alt="Complete" /></button>
        </div>
    </div>

    <div id="alarm" class="alarm"></div>

    <div class="content">
        <div class="sidebar">
            <div class="sidebar-content">
                <div class="switch-expert">
                    <button id="switchExpertButton" class="custom-button expert-button">
                        <img src="images/png/reload.png" style="height: 25px; vertical-align: middle; margin-right: 10px;" alt="Reload" />
                        Сменить собеседника
                    </button>
                </div>
                <div class="remaining-time">
                    <img src="images/png/stopwatch.png" style="height: 25px; vertical-align: middle; margin-right: 10px;" alt="Stopwatch" />
                    <b id="remainingTime">00</b> минуты осталось
                </div>

                <ul class="appeal-info">
                    <li>
                        <div class="one-line appeal-caption">Номер апелляции</div>
                        <div class="one-line appeal-value">14091</div>
                    </li>
                    <li>
                        <div class="one-line appeal-caption">Предмет</div>
                        <div class="one-line appeal-value">Русский язык</div>
                    </li>
                    <li>
                        <div class="one-line appeal-caption">Дата экзамена</div>
                        <div class="one-line appeal-value">14.06.2018</div>
                    </li>
                    <li>
                        <div class="one-line appeal-caption">Зарегистрирована</div>
                        <div class="one-line appeal-value">26.07.2018 14:15</div>
                    </li>
                    <li>
                        <div class="one-line appeal-caption">Подано заявление</div>
                        <div class="one-line appeal-value">26.07.2018 14:20</div>
                    </li>
                </ul>
                <ul class="other-info">
                    <li>Справочная служба конфликтной комиссии г. Москвы</li>
                    <li class="other-contact">
                        <img src="images/png/phone-call.png" style="height: 20px; vertical-align: middle; margin-right: 10px;" alt="Phone" />
                        <a style="color: #8d8d8d; text-decoration: none;" href="tel:+74953660692">+7 (495) 366-06-92</a>
                    </li>
                    <li class="other-contact">
                        <img src="images/png/envelope.png" style="height: 20px; vertical-align: middle; margin-right: 10px;" alt="Email" />
                        <a style="color: #8d8d8d; text-decoration: none;" href="mailto:kk77@mcko.ru">kk77@mcko.ru</a>
                    </li>
                </ul>
            </div>
            <div class="footer">2018 (C) Конфликтная комиссия города Москвы</div>
        </div>
        <div class="main">
            <div class="main-header">
                <div class="header-title">Член конфликтной комиссии</div>
                <div class="online-status" id="onlineStatus"></div>
                <span class="write-status" id="writeStatus">Печатает...</span>
            </div>
            <ul id="messagesList" class="message-history" style="overflow-y: auto; padding:10px; background: #bbdbf2; flex:auto; display: flex; flex-flow: column-reverse; color: #8d8d8d;">
                @foreach (var message in Model.Messages)
                {
                    var messageDate = message.CreateDate.ToString("T");

                    var isCurrent = message.NickName == "Аппелянт";

                    var nickname = isCurrent ? "Вы" : message.NickName;

                    <li>
                        <div class="message @(isCurrent ? "place-left" : "place-right")">
                            @switch (message.ChatMessageTypeId)
                            {
                                case ChatMessageTypes.Joined:
                                    @nickname @(isCurrent ? " подключились" : " подключился") @:к консультации <b class="message-date">@messageDate</b>
                                    break;
                                case ChatMessageTypes.Message:
                                    <div class="message-bubble">@Html.Raw(message.MessageString)</div>@nickname <b class="message-date">@messageDate</b>
                                    break;
                                case ChatMessageTypes.Leave:
                                    @nickname @(isCurrent ? " покинули" : " покинул") @:консультацию <b class="message-date">@messageDate</b>
                                    break;
                            }
                        </div>
                    </li>
                }
            </ul>
            <div class="main-footer">
                <textarea id="messageText" class="message-text" data-min-rows="1" rows="1" autocomplete="off" placeholder="Введите сообщение..."></textarea>
                <button id="sendButton" class="custom-button send-button">
                    <div class="image-wrapper"><img src="images/png/send-mail.png" style="height: 20px;" alt="Send" /></div>
                </button>
            </div>
        </div>
    </div>
</div>

@*<div class="container">
        <partial name="_Header" />

        <div id="alarm" class="alarm"></div>

        <div class="content">
            <div class="main">
                <ul id="messagesList" class="message-history">
                    @foreach (var message in Model.Messages)
                    {
                        var messageDate = message.CreateDate.ToString("G");

                        var isCurrent = message.NickName == "Аппелянт";

                        var nickname = isCurrent ? "Вы" : message.NickName;

                        <li>
                            <div class="message @(isCurrent ? "place-left" : "place-right")">
                                @switch (message.ChatMessageTypeId)
                                {
                                    case ChatMessageTypes.Joined:
                                        @nickname @(isCurrent ? " подключились" : " подключился") @:к консультации <b>(@messageDate) </b>
                                        break;
                                    case ChatMessageTypes.Message:
                                        <div class="message-bubble">@Html.Raw(message.MessageString)</div>@nickname <b>(@messageDate)</b>
                                        break;
                                    case ChatMessageTypes.Leave:
                                        @nickname @(isCurrent ? " покинули" : " покинул") @:консультацию <b>(@messageDate)</b>
                                        break;
                                }
                            </div>
                        </li>
                    }
                </ul>
                <div class="remaining-time">До конца консультации осталось: <b id="remainingTime">00</b></div>
                <div id="emojiGrid" class="emoji-grid" style="display:none;"></div>
                <div class="form-footer">
                    <button id="emojiButton" class="form-button"><img alt="Emoji" src="~/images/OpenSmilesTab.png" /></button>
                    <textarea id="messageText" class="message-text" data-min-rows="1" rows="1" autocomplete="off" placeholder="Введите сообщение..."></textarea>
                    <button id="sendButton" class="form-button"><img alt="Send" src="~/images/send.png" /></button>
                </div>
            </div>
            <div class="sidebar">
                <div class="info">
                    <div style="border-bottom: 1px solid #ccc;">
                        <div style="margin-bottom:15px; text-align: center; background:#fff; border: 2px solid #ff8d00; padding: 10px; overflow: hidden; border-radius: 5px; position: relative;">
                            <div style="font-size: 14px; color: #757575">Вас консультирует</div>
                            @if (Model.OnlineExpertKeys != null)
                            {
                                <div style="font-size: 22px; font-weight: bold;">Член<br />конфликтной комиссии</div>
                                <div style="font-size: 28px; font-weight: bold;">
                                    №
                                    <span id="expertNumbers">
                                        @foreach (var expertKey in Model.OnlineExpertKeys)
                                        {
                                            <span class="expert-key" data-key="@expertKey">@expertKey</span>
                                        }
                                    </span>
                                </div>
                                <div id="changeOverlay" class="loader-overlay center">
                                    <div id="changeSpinner" class="spinner"></div>
                                </div>
                            }
                            else
                            {
                                <div style="font-size: 22px; font-weight: bold;">NULL</div>
                            }
                        </div>
                        <button id="switchExpertButton" class="custom-button" style="margin-bottom: 15px; padding: 7px;">
                            <div class="one-line"><img src="~/images/shuffle.png" /></div>
                            <div class="one-line">Сменить собеседника</div>
                        </button>
                        <button id="completeButton" class="custom-button complete-button" style="margin-bottom: 15px;">Завершить консультацию</button>
                    </div>
                    <div style="border-bottom: 1px solid #ccc; font-size: 18px; padding: 10px 0;">
                        <ul>
                            <li style="margin: 5px 0;">
                                <div>Номер апелляции</div>
                                <div style="font-weight: bold;">@Model.ChatSession.AppealNumber</div>
                            </li>
                            <li style="margin: 5px 0;">
                                <div>Подано заявление</div>
                                <div style="font-weight: bold;">@Model.ChatSession.ApplicationDate.ToString("g")</div>
                            </li>
                            <li style="margin: 5px 0;">
                                <div>Зарегистрирована</div>
                                <div style="font-weight: bold;">@Model.ChatSession.RegistrationDate.ToString("g")</div>
                            </li>
                            <li style="margin: 5px 0;">
                                <div>Предмет</div>
                                <div style="font-weight: bold;">@Model.ChatSession.SubjectName</div>
                            </li>
                            <li style="margin-bottom: 5px;">
                                <div>Дата экзамена</div>
                                <div style="font-weight: bold;">@Model.ChatSession.ExamDate.ToShortDateString()</div>
                            </li>
                        </ul>
                    </div>
                    <div style="font-size: 18px; padding: 10px 0;">
                        <div style="margin-bottom: 10px;">
                            <div class="one-line"><a href="#">Инструкция по работе с чатом</a></div>
                            <img class="one-line" src="~/images/download.png" />
                        </div>
                        <div>Справочная служба конфликтной комиссии г. Москвы</div>
                        <div style="margin-bottom: 10px;">
                            <img class="one-line" src="~/images/phone-call.png" />
                            <div class="one-line"><a href="tel:+74953660692">+7 (495) 366-06-92</a></div>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <img class="one-line" src="~/images/EMail.png" />
                            <div class="one-line"><a href="mailto:kk77@mcko.ru">kk77@mcko.ru</a></div>
                        </div>
                    </div>
                </div>
                <div class="footer">Московское время: <span id="moscowTime">00:00</span></div>
                <partial name="_Footer" />
            </div>
        </div>
    </div>*@

<div id="modal" style="display: none;" class="modal-overlay center"></div>