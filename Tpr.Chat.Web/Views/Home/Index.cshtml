@using Tpr.Chat.Core.Constants
@using Tpr.Chat.Core.Models
@model Tpr.Chat.Web.ViewModels.IndexViewModel
@{
    ViewData["Title"] = "Home Page";
}
<div class="sidebar">
    @if (Model.Role == ChatRole.Appeal)
    {
        <div class="expert-info" style="text-align: center; padding: 10px; border-bottom: 1px solid #000">
            <div class="expert-image"><img style="width: 150px; height: 150px;" src="~/images/account.png" alt="Account" /></div>
            <div class="expert-name" style="font-size: 20px">Член конфликтной комиссии <br/> №{ EXPERT_NUMBER }</div>
            <hr />
            <a href="/" class="link-button"><i class="fas fa-exchange-alt glyph"></i>Сменить собеседника</a>
        </div>
    }
    <div class="appeal-info" style="padding:15px;">
        <ul style="list-style: none; margin: 0; padding: 0">
            <li style="border-bottom: 1px solid #000; padding: 15px 0;"><span>Номер аппеляции</span><span style="float: right">{ APPEAL_NUMBER }</span></li>
            <li style="border-bottom: 1px solid #000; padding: 15px 0;"><span>Предмет</span><span style="float: right">{ APPEAL_SUBJECT }</span></li>
            <li style="padding: 15px 0;"><span>Дата экзамена</span><span style="float: right">{ APPEAL_EXAMDATE }</span></li>
        </ul>
    </div>
    <div class="footer" style="text-align: center">
        <div class="moscow-time" style="padding: 5px; border-bottom: 1px solid">Московское время: { MOSCOW_TIME }</div>
        <a href="/" class="hide-info-panel"><i class="fas fa-chevron-circle-up" style="margin-right: 5px; font-size: 20px; vertical-align: middle;"></i>Скрыть информационную панель</a>
    </div>
</div>
<div class="main-content">
    <div class="chat-header">
        <a href="/" class="complete-button link-button"><i class="fas fa-check-circle glyph"></i>Завершить консультацию</a>
        <div class="caption"><i class="fab fa-adn glyph" style="font-size: 26px;"></i>Система онлайн-консультирования по вопросам...</div>
    </div>
    <div class="messages-list">
        <ul id="messagesList">
            @foreach (var message in Model.Messages)
            {
                var isAppeal = message.NickName == "Аппелянт";

                var messageDate = @message.CreateDate.ToString("HH:mm:ss");

                <li class="message@(isAppeal ? " place-left" : " place-right")">
                    @switch (message.ChatMessageTypeId)
                    {
                        case ChatMessageTypes.Joined:
                            <span>@message.NickName</span><p>подключился к консультации </p><span>(@messageDate)</span>
                            break;
                        case ChatMessageTypes.Message:
                            <div class="message-bubble">@message.MessageString</div><span class="nickname">@message.NickName</span> <span>(@messageDate)</span>
                            break;
                        case ChatMessageTypes.Leave:
                            <span>@message.NickName</span><p>покинул консультацию </p><span>(@messageDate)</span>
                            break;
                    }
                </li>
            }
        </ul>
    </div>
    <div class="footer">
        <div class="time-caption">До конца консультации осталось <span id="remaining-time">{ REMAINING_TIME }</span> минут</div>
        <div class="message-form">
            <form id="chatForm">
                <button class="send-button" id="sendButton" name="sendButton" type="submit"><i class="far fa-paper-plane"></i>Send</button>
                <button class="emoji-button" type="button"><i class="far fa-smile"></i>Emoji</button>
                <div style="overflow: hidden;">
                    <textarea id="messageInput" class="send-textbox" style="resize: none" data-max-rows="5" rows="1" autocomplete="off" placeholder="Введите сообщение..." ></textarea>
                </div>
            </form>
        </div>
    </div>
</div>
<script>
    var appealId = "@Model.AppealId";
</script>

<script src="~/lib/signalr/signalr.js"></script>
<script src="~/js/chat.js"></script>
